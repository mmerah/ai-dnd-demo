{
  "rules": [
    {
      "rule_id": "inventory_changes",
      "rule_class": "InventoryChangeRule",
      "enabled": true,
      "description": "Detects item acquisition, loss, or transfer",
      "patterns": [
        {
          "pattern": "\\b(find|discover|loot|take|pick up|acquire|obtain|receive|get)(s|ing|ed)?\\b.*\\b(item|sword|armor|potion|weapon|shield|ring|amulet|treasure)\\b",
          "weight": 0.85,
          "description": "Item acquisition"
        },
        {
          "pattern": "\\b(give|hand|offer|sell|trade|drop|lose|discard)(s|ing|ed)?\\b.*\\b(item|sword|armor|potion|weapon)\\b",
          "weight": 0.8,
          "description": "Item transfer or loss"
        }
      ],
      "suggestions": [
        {
          "tool_name": "modify_inventory",
          "reason": "Items need to be added or removed from inventory",
          "confidence_multiplier": 1.0
        }
      ],
      "applicable_agents": ["narrative", "npc_individual", "npc_puppeteer"],
      "base_confidence": 0.75
    },
    {
      "rule_id": "currency_transactions",
      "rule_class": "CurrencyTransactionRule",
      "enabled": true,
      "description": "Detects currency changes (gold, silver, copper)",
      "patterns": [
        {
          "pattern": "\\b(\\d+)\\s+(gold|silver|copper|gp|sp|cp|coins?)\\b",
          "weight": 0.9,
          "description": "Currency amounts"
        },
        {
          "pattern": "\\b(pay|spend|buy|purchase|sell|earn|receive|reward)(s|ing|ed)?\\b.*\\b(gold|silver|copper|gp|sp|cp|coins?)\\b",
          "weight": 0.85,
          "description": "Currency transactions"
        },
        {
          "pattern": "\\b(costs?|price|fee|payment)\\b.*\\b(\\d+)\\b",
          "weight": 0.75,
          "description": "Price mentions"
        }
      ],
      "suggestions": [
        {
          "tool_name": "modify_currency",
          "reason": "Currency amount has changed",
          "confidence_multiplier": 1.0
        }
      ],
      "applicable_agents": ["narrative", "npc_individual", "npc_puppeteer"],
      "base_confidence": 0.8
    },
    {
      "rule_id": "party_management",
      "rule_class": "PartyManagementRule",
      "enabled": true,
      "description": "Detects party member additions or departures",
      "patterns": [
        {
          "pattern": "\\b(join|joins|joining)\\s+(the|your)?\\s+(party|group|team)\\b",
          "weight": 0.95,
          "description": "Party member joining"
        },
        {
          "pattern": "\\b(leave|leaves|leaving|depart|parts? ways)\\s+(the|your)?\\s+(party|group|team)\\b",
          "weight": 0.95,
          "description": "Party member leaving"
        },
        {
          "pattern": "\\b(accompan(y|ies)|travel(s)? with|follow(s)?)\\s+(you|the party)\\b",
          "weight": 0.8,
          "description": "Companion indicators"
        }
      ],
      "suggestions": [
        {
          "tool_name": "add_party_member",
          "reason": "NPC is joining the party",
          "confidence_multiplier": 1.1
        },
        {
          "tool_name": "remove_party_member",
          "reason": "NPC is leaving the party",
          "confidence_multiplier": 1.1
        }
      ],
      "applicable_agents": ["narrative"],
      "required_context": ["npcs"],
      "base_confidence": 0.85
    },
    {
      "rule_id": "time_passage",
      "rule_class": "TimePassageRule",
      "enabled": true,
      "description": "Detects time advancement and rest periods",
      "patterns": [
        {
          "pattern": "\\b(short rest|take a break|catch breath|brief respite)\\b",
          "weight": 0.95,
          "description": "Short rest indicators"
        },
        {
          "pattern": "\\b(long rest|sleep|camp|night passes|retire for the night|settle down|rest until dawn)\\b",
          "weight": 0.95,
          "description": "Long rest indicators"
        },
        {
          "pattern": "\\b(hours? later|days? pass(es)?|time passes|after (a|some) time|next (morning|day))\\b",
          "weight": 0.8,
          "description": "Time passage phrases"
        }
      ],
      "suggestions": [
        {
          "tool_name": "short_rest",
          "reason": "Characters are taking a short rest",
          "confidence_multiplier": 1.2
        },
        {
          "tool_name": "long_rest",
          "reason": "Characters are taking a long rest",
          "confidence_multiplier": 1.2
        },
        {
          "tool_name": "advance_time",
          "reason": "Time has passed in the narrative",
          "confidence_multiplier": 1.0
        }
      ],
      "applicable_agents": ["narrative"],
      "base_confidence": 0.85
    },
    {
      "rule_id": "location_transitions",
      "rule_class": "LocationTransitionRule",
      "enabled": true,
      "description": "Detects movement to new significant locations",
      "patterns": [
        {
          "pattern": "\\b(arriv(e|ed|ing)|enter(s|ed|ing)|reach(es|ed|ing))\\s+(the|a)?\\s+[A-Z]",
          "weight": 0.85,
          "description": "Arrival at named location"
        },
        {
          "pattern": "\\b(discover|find|reveal|uncover)(s|ed|ing)?\\s+(secret|hidden|passage|door)\\b",
          "weight": 0.9,
          "description": "Secret discovery"
        }
      ],
      "suggestions": [
        {
          "tool_name": "change_location",
          "reason": "Character has arrived at a significant named location",
          "confidence_multiplier": 1.0
        },
        {
          "tool_name": "discover_secret",
          "reason": "Hidden content has been revealed",
          "confidence_multiplier": 1.1
        }
      ],
      "applicable_agents": ["narrative"],
      "base_confidence": 0.7
    },
    {
      "rule_id": "combat_initiation",
      "rule_class": "CombatInitiationRule",
      "enabled": true,
      "description": "Detects hostile actions and combat start indicators",
      "patterns": [
        {
          "pattern": "\\b(attack|strike|engage|charge|rush|lunge at)\\b",
          "weight": 0.95,
          "description": "Direct combat actions"
        },
        {
          "pattern": "\\b(draw|unsheathe|ready)\\s+(my|our|the)?\\s+(weapon|sword|bow|blade|axe)s?\\b",
          "weight": 0.9,
          "description": "Weapon preparation"
        },
        {
          "pattern": "\\b(fight|combat|battle|brawl)\\s+(the|them|it)?\\b",
          "weight": 0.85,
          "description": "Combat declaration"
        },
        {
          "pattern": "\\b(defend|protect)\\s+(myself|ourselves|against)\\b",
          "weight": 0.8,
          "description": "Defensive combat posture"
        },
        {
          "pattern": "\\b(ambush|surprise attack|sneak attack|initiative)\\b",
          "weight": 0.95,
          "description": "Combat surprise/initiative"
        },
        {
          "pattern": "\\b(hostile|aggressive|threatens?|menacing)\\b.*\\b(approach|moves? toward|advances?)\\b",
          "weight": 0.85,
          "description": "Hostile approach"
        },
        {
          "pattern": "\\b(cast|prepare)\\s+.*\\b(spell|magic|fireball|missile)\\b.*\\b(at|on|toward)\\b",
          "weight": 0.9,
          "description": "Offensive spell targeting"
        }
      ],
      "suggestions": [
        {
          "tool_name": "start_encounter_combat",
          "reason": "Triggering a predefined encounter",
          "confidence_multiplier": 1.2
        },
        {
          "tool_name": "start_combat",
          "reason": "Player is initiating combat with enemies",
          "confidence_multiplier": 1.0
        }
      ],
      "applicable_agents": ["narrative"],
      "base_confidence": 0.85
    },
    {
      "rule_id": "dice_roll",
      "rule_class": "DiceRollRule",
      "enabled": true,
      "description": "Detects actions requiring ability checks, skill checks, or saves",
      "patterns": [
        {
          "pattern": "\\b(scan|look around|search|examine|inspect|investigate)\\b",
          "weight": 0.9,
          "description": "Perception/Investigation checks"
        },
        {
          "pattern": "\\b(sneak|hide|move quietly|stay hidden|stealth)\\b",
          "weight": 0.95,
          "description": "Stealth checks"
        },
        {
          "pattern": "\\b(climb|jump|leap|balance|acrobat)\\b",
          "weight": 0.9,
          "description": "Athletics/Acrobatics checks"
        },
        {
          "pattern": "\\b(persuade|convince|negotiate|charm|diplomat)\\b",
          "weight": 0.9,
          "description": "Persuasion/Diplomacy checks"
        },
        {
          "pattern": "\\b(deceive|lie|bluff|trick|misdirect)\\b",
          "weight": 0.9,
          "description": "Deception checks"
        },
        {
          "pattern": "\\b(intimidate|threaten|coerce|menace)\\b",
          "weight": 0.9,
          "description": "Intimidation checks"
        },
        {
          "pattern": "\\b(listen|hear|eavesdrop|sound)\\b",
          "weight": 0.85,
          "description": "Perception (hearing) checks"
        },
        {
          "pattern": "\\b(recall|remember|know about|history|knowledge)\\b",
          "weight": 0.85,
          "description": "Knowledge/History checks"
        },
        {
          "pattern": "\\b(sense|detect|feel|insight|motive)\\b",
          "weight": 0.85,
          "description": "Insight checks"
        },
        {
          "pattern": "\\b(survive|track|forage|navigate|wilderness)\\b",
          "weight": 0.9,
          "description": "Survival checks"
        },
        {
          "pattern": "\\b(handle|calm|train|ride)\\s+(animal|beast|horse|mount)\\b",
          "weight": 0.9,
          "description": "Animal Handling checks"
        },
        {
          "pattern": "\\b(perform|play|entertain|music|dance|song)\\b",
          "weight": 0.85,
          "description": "Performance checks"
        },
        {
          "pattern": "\\b(pick|unlock|disable|lockpick|thieves)\\s+(lock|trap)\\b",
          "weight": 0.95,
          "description": "Sleight of Hand/Thieves' Tools checks"
        },
        {
          "pattern": "\\b(arcana|magic|spell|enchant|identify)\\b.*\\b(check|understand|recognize)\\b",
          "weight": 0.9,
          "description": "Arcana checks"
        },
        {
          "pattern": "\\b(nature|plant|creature|animal)\\b.*\\b(check|knowledge|identify)\\b",
          "weight": 0.85,
          "description": "Nature checks"
        },
        {
          "pattern": "\\b(religion|divine|holy|deity|undead)\\b.*\\b(check|knowledge|recognize)\\b",
          "weight": 0.85,
          "description": "Religion checks"
        },
        {
          "pattern": "\\b(medicine|heal|diagnose|stabilize|treat)\\b",
          "weight": 0.9,
          "description": "Medicine checks"
        },
        {
          "pattern": "\\b(save|saving throw|resist|constitution save|dex save|wisdom save)\\b",
          "weight": 0.95,
          "description": "Saving throws"
        }
      ],
      "suggestions": [
        {
          "tool_name": "roll_dice",
          "reason": "Action requires an ability check or saving throw",
          "confidence_multiplier": 1.0
        }
      ],
      "applicable_agents": ["narrative"],
      "base_confidence": 0.8
    }
  ],
  "global_settings": {
    "min_confidence_threshold": 0.6,
    "max_suggestions_per_turn": 3,
    "enable_rule_chaining": false,
    "debug_mode": false,
    "rule_priority_order": [
      "combat_initiation",
      "dice_roll",
      "currency_transactions",
      "inventory_changes",
      "party_management",
      "time_passage",
      "location_transitions"
    ]
  }
}
