<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D 5e AI Dungeon Master</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Character Selection Screen -->
    <div id="characterSelection" class="screen">
        <div class="selection-container">
            <h1>D&D 5e AI Dungeon Master</h1>
            <div style="margin-bottom: 1rem;">
                <button id="openCatalogsHome" class="btn-small">üìö Browse Catalogs</button>
            </div>
            
            <!-- Saved Games Section -->
            <div id="savedGamesSection" class="saved-games-section">
                <h2>‚ñº Continue Your Adventures</h2>
                <div id="savedGamesList" class="saved-games-list">
                    <!-- Saved games loaded dynamically -->
                </div>
            </div>
            
            <!-- Divider between sections -->
            <div class="section-divider">
                <span>OR</span>
            </div>
            
            <!-- New Game Section -->
            <div id="newGameSection" class="new-game-section">
                <h2>‚ñº Start New Adventure</h2>
                <h3>Select Your Character</h3>
                <div id="characterList" class="character-grid">
                    <!-- Characters loaded dynamically -->
                </div>
                <div class="premise-section">
                    <h3>Select Scenario</h3>
                    <div id="scenarioList" class="scenario-list">
                        <!-- Scenarios loaded dynamically -->
                    </div>
                    
                    <!-- Content Pack Selection -->
                    <div id="contentPackSection" class="content-pack-section" style="display: none; margin-top: 1rem;">
                        <h3>Additional Content Packs (Optional)</h3>
                        <div id="contentPackList" class="content-pack-list">
                            <!-- Content packs loaded dynamically -->
                        </div>
                    </div>
                    
                    <button id="startGame" class="btn-primary" disabled>Start Adventure</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Game Interface -->
    <div id="gameInterface" class="screen hidden">
        <!-- Header Bar -->
            <div class="header-bar">
            <div class="location-time">
                <span class="location">üìç <span id="currentLocation">Unknown</span> <span id="dangerLevel" class="danger-indicator"></span></span>
                <span class="time">üïê <span id="gameTime">Day 1, 12:00</span></span>
                <span id="combatIndicator" class="combat-indicator hidden">‚öîÔ∏è COMBAT</span>
                <span id="agentIndicator" class="agent-indicator">ü§ñ <span id="activeAgent">Narrative</span></span>
            </div>
            <div>
                <button id="saveGame" class="btn-small">üíæ Save</button>
            </div>
            </div>

        <!-- Split Screen Container -->
        <div class="game-container">
            <!-- Character Sheet (Left) -->
            <div class="character-sheet">
                <!-- Party Section -->
                <div class="party-section">
                    <div class="party-header">
                        <h2>Party</h2>
                        <span class="party-count" id="partyCount">1/4</span>
                    </div>
                    <div class="party-members" id="partyMembers">
                        <!-- Party member cards will be populated dynamically -->
                    </div>
                </div>

                <!-- Location Info -->
                <div class="sheet-section">
                    <h3>Current Location</h3>
                    <div class="location-info">
                        <div class="location-description" id="locationDescription">
                            <!-- Location description will be populated here -->
                        </div>
                        <div class="location-connections">
                            <h4>Available Exits:</h4>
                            <div id="locationConnections" class="connections-list">
                                <!-- Connections will be populated here -->
                            </div>
                        </div>
                        <div class="location-npcs" id="locationNPCs" style="display: none;">
                            <h4>People here:</h4>
                            <div id="npcsList" class="npcs-list">
                                <!-- NPCs will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Combat Information Panel -->
                <div class="sheet-section" id="combatSection" style="display: none;">
                    <h3>‚öîÔ∏è Combat Status</h3>
                    <div class="combat-info">
                        <div class="combat-header">
                            <div class="combat-round">
                                <span class="label">Round:</span>
                                <span id="combatRound" class="combat-value">1</span>
                            </div>
                            <div class="combat-turn">
                                <span class="label">Current Turn:</span>
                                <span id="currentTurn" class="combat-value">-</span>
                            </div>
                        </div>
                        <div class="turn-order">
                            <h4>Turn Order:</h4>
                            <div id="turnOrderList" class="turn-order-list">
                                <!-- Turn order will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chronicle Panel (Memory + Journal) -->
                <div class="sheet-section chronicle-section collapsible">
                    <h3 class="collapsible-header">Chronicle <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <!-- Tabs for filtering -->
                        <div class="chronicle-tabs">
                            <button class="chronicle-tab active" data-filter="all">All</button>
                            <button class="chronicle-tab" data-filter="world">World</button>
                            <button class="chronicle-tab" data-filter="locations">Locations</button>
                            <button class="chronicle-tab" data-filter="npcs">NPCs</button>
                            <button class="chronicle-tab" data-filter="notes">My Notes</button>
                        </div>

                        <!-- Search box -->
                        <div class="chronicle-search-container">
                            <input type="text" id="chronicleSearchInput" class="chronicle-search-input" placeholder="Search entries...">
                            <button id="chronicleSearchClear" class="chronicle-search-clear" style="display: none;">√ó</button>
                        </div>

                        <!-- Location filter toggle -->
                        <div class="chronicle-filter-toggle">
                            <label>
                                <input type="checkbox" id="showAllLocations">
                                Show all locations
                            </label>
                        </div>

                        <!-- New Note button -->
                        <button id="newNoteButton" class="btn-small chronicle-new-note">+ New Note</button>

                        <!-- Chronicle entries list -->
                        <div id="chronicleEntries" class="chronicle-entries">
                            <!-- Entries will be populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Selected Member Details Header -->
                <div class="selected-member-header">
                    <h3 id="selectedMemberName">Character Details</h3>
                </div>

                <!-- Basic Info -->
                <div class="sheet-section">
                    <h3>Basic Information</h3>
                    <div class="basic-info">
                        <div class="info-row">
                            <span class="label">Name:</span>
                            <span id="charName">-</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Race:</span>
                            <span id="charRace">-</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Subrace:</span>
                            <span id="charSubrace">-</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Class:</span>
                            <span id="charClass">-</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Subclass:</span>
                            <span id="charSubclass">-</span>
                        </div>
                        <div class="info-row">
                            <span class="label">Level:</span>
                            <span id="charLevel">-</span>
                        </div>
                    </div>
                </div>

                <!-- Combat Stats -->
                <div class="sheet-section">
                    <h3>Combat Stats</h3>
                    <div class="combat-stats">
                        <div class="hp-container">
                            <span class="label">HP:</span>
                            <div class="hp-bar">
                                <div id="hpFill" class="hp-fill"></div>
                                <span id="hpText" class="hp-text">0/0</span>
                            </div>
                        </div>
                        <div class="stat-row">
                            <div class="stat-item">
                                <span class="label">AC:</span>
                                <span id="charAC">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">Initiative:</span>
                                <span id="charInitiative">-</span>
                            </div>
                            <div class="stat-item">
                                <span class="label">Speed:</span>
                                <span id="charSpeed">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attacks -->
                <div class="sheet-section collapsible">
                    <h3 class="collapsible-header">Attacks <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <div id="attacksList" class="attacks-list">
                            <!-- Attacks will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Abilities -->
                <div class="sheet-section collapsible">
                    <h3 class="collapsible-header">Abilities <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <div class="abilities-grid">
                            <div class="ability">
                                <span class="ability-name">STR</span>
                                <span id="strScore" class="ability-score">-</span>
                                <span id="strMod" class="ability-mod">+0</span>
                            </div>
                            <div class="ability">
                                <span class="ability-name">DEX</span>
                                <span id="dexScore" class="ability-score">-</span>
                                <span id="dexMod" class="ability-mod">+0</span>
                            </div>
                            <div class="ability">
                                <span class="ability-name">CON</span>
                                <span id="conScore" class="ability-score">-</span>
                                <span id="conMod" class="ability-mod">+0</span>
                            </div>
                            <div class="ability">
                                <span class="ability-name">INT</span>
                                <span id="intScore" class="ability-score">-</span>
                                <span id="intMod" class="ability-mod">+0</span>
                            </div>
                            <div class="ability">
                                <span class="ability-name">WIS</span>
                                <span id="wisScore" class="ability-score">-</span>
                                <span id="wisMod" class="ability-mod">+0</span>
                            </div>
                            <div class="ability">
                                <span class="ability-name">CHA</span>
                                <span id="chaScore" class="ability-score">-</span>
                                <span id="chaMod" class="ability-mod">+0</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Skills -->
                <div class="sheet-section collapsible">
                    <h3 class="collapsible-header">Skills <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <div id="skillsList" class="skills-list">
                            <!-- Skills loaded dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Features -->
                <div class="sheet-section collapsible">
                    <h3 class="collapsible-header">Features <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <div class="features-traits-container">
                            <div class="feature-trait-section">
                                <h4>Class Features</h4>
                                <div id="featureIndexList" class="tag-list"></div>
                            </div>
                            <div class="feature-trait-section">
                                <h4>Custom Features</h4>
                                <div id="featureTextList" class="feature-list"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Traits -->
                <div class="sheet-section collapsible">
                    <h3 class="collapsible-header">Racial Traits <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <div class="features-traits-container">
                            <div class="feature-trait-section">
                                <h4>Racial Traits</h4>
                                <div id="traitIndexList" class="tag-list"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Feats -->
                <div class="sheet-section collapsible">
                    <h3 class="collapsible-header">Feats <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <div id="featIndexList" class="tag-list"></div>
                    </div>
                </div>

                <!-- Spellcasting -->
                <div class="sheet-section collapsible">
                    <h3 class="collapsible-header">Spellcasting <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <div class="spell-slots">
                            <h4>Spell Slots</h4>
                            <div id="spellSlots" class="slots-grid">
                                <!-- Spell slots loaded dynamically -->
                            </div>
                        </div>
                        <div class="spell-list">
                            <h4>Known Spells</h4>
                            <div id="spellList" class="spells">
                                <!-- Spells loaded dynamically -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Equipment Slots -->
                <div class="sheet-section collapsible">
                    <h3 class="collapsible-header">Equipment <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <div class="equipment-slots-grid">
                            <!-- Head and Accessories -->
                            <div class="equipment-slot-group">
                                <h4>Head & Accessories</h4>
                                <div class="equipment-slot" data-slot="head">
                                    <span class="slot-label">Head</span>
                                    <div class="slot-item" id="slot-head">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                                <div class="equipment-slot" data-slot="neck">
                                    <span class="slot-label">Neck</span>
                                    <div class="slot-item" id="slot-neck">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                                <div class="equipment-slot" data-slot="back">
                                    <span class="slot-label">Back</span>
                                    <div class="slot-item" id="slot-back">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Body -->
                            <div class="equipment-slot-group">
                                <h4>Body</h4>
                                <div class="equipment-slot" data-slot="chest">
                                    <span class="slot-label">Chest</span>
                                    <div class="slot-item" id="slot-chest">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                                <div class="equipment-slot" data-slot="waist">
                                    <span class="slot-label">Waist</span>
                                    <div class="slot-item" id="slot-waist">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                                <div class="equipment-slot" data-slot="hands">
                                    <span class="slot-label">Hands</span>
                                    <div class="slot-item" id="slot-hands">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                                <div class="equipment-slot" data-slot="feet">
                                    <span class="slot-label">Feet</span>
                                    <div class="slot-item" id="slot-feet">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Weapons & Shield -->
                            <div class="equipment-slot-group">
                                <h4>Weapons & Shield</h4>
                                <div class="equipment-slot" data-slot="main_hand">
                                    <span class="slot-label">Main Hand</span>
                                    <div class="slot-item" id="slot-main_hand">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                                <div class="equipment-slot" data-slot="off_hand">
                                    <span class="slot-label">Off Hand</span>
                                    <div class="slot-item" id="slot-off_hand">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                                <div class="equipment-slot" data-slot="ammunition">
                                    <span class="slot-label">Ammunition</span>
                                    <div class="slot-item" id="slot-ammunition">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Rings -->
                            <div class="equipment-slot-group">
                                <h4>Rings</h4>
                                <div class="equipment-slot" data-slot="ring_1">
                                    <span class="slot-label">Ring 1</span>
                                    <div class="slot-item" id="slot-ring_1">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                                <div class="equipment-slot" data-slot="ring_2">
                                    <span class="slot-label">Ring 2</span>
                                    <div class="slot-item" id="slot-ring_2">
                                        <span class="empty-slot">Empty</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventory -->
                <div class="sheet-section collapsible">
                    <h3 class="collapsible-header">Inventory <span class="toggle">‚ñº</span></h3>
                    <div class="collapsible-content">
                        <div class="currency">
                            <span>Gold: <span id="goldAmount">0</span></span>
                            <span>Silver: <span id="silverAmount">0</span></span>
                            <span>Copper: <span id="copperAmount">0</span></span>
                        </div>
                        <div id="inventoryList" class="inventory-list">
                            <!-- Items loaded dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Conditions -->
                <div class="sheet-section" id="conditionsSection" style="display: none;">
                    <h3>Active Conditions</h3>
                    <div id="conditionsList" class="conditions-list">
                        <!-- Conditions loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Chat Interface (Right) -->
            <div class="chat-interface">
                <div id="chatMessages" class="chat-messages">
                    <div class="message system">
                        <p>Welcome to your D&D adventure! Type your actions and the AI Dungeon Master will respond.</p>
                    </div>
                </div>

                <!-- Combat Suggestion Card -->
                <div id="combatSuggestion" class="combat-suggestion" style="display: none;">
                    <div class="suggestion-header">
                        <span class="suggestion-title" id="suggestionTitle">Ally's Turn</span>
                    </div>
                    <div class="suggestion-text" id="suggestionText">
                        <!-- Suggestion text will be populated here -->
                    </div>
                    <div class="suggestion-actions">
                        <button id="acceptSuggestionBtn" class="btn-accept">Use This Action</button>
                        <button id="overrideSuggestionBtn" class="btn-override">Do Something Else</button>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="input-area">
                    <textarea id="messageInput" placeholder="What do you do?" rows="3"></textarea>
                    <button id="sendMessage" class="btn-primary">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Catalogs Screen -->
    <div id="catalogsScreen" class="screen hidden">
        <div class="selection-container">
            <h2>Catalogs</h2>
            <div id="catalogsNav" class="catalogs-nav"></div>
            
            <!-- Content Pack Filter -->
            <div id="catalogPackFilter" class="catalog-pack-filter" style="margin-top:10px; padding:10px; background:rgba(255,255,255,0.03); border-radius:4px;">
                <label style="display:block; margin-bottom:5px; font-weight:bold;">Filter by Content Pack:</label>
                <div id="catalogPackCheckboxes" class="pack-filter-list" style="display:flex; flex-wrap:wrap; gap:10px;"></div>
            </div>
            
            <div style="margin-top:6px;">
                <button id="catBackBtn" class="btn-small">‚¨Ö Back</button>
            </div>
            <div id="catalogsContentList" class="catalogs-list" style="margin-top:8px;"></div>
            <div class="pagination" style="margin-top:8px; display:flex; gap:8px; align-items:center;">
                <button id="catPrevBtn" class="btn-small">Prev</button>
                <span id="catPageInfo"></span>
                <button id="catNextBtn" class="btn-small">Next</button>
            </div>
        </div>
    </div>

    <!-- Journal Entry Modal -->
    <div id="journalModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="journalModalTitle">New Journal Entry</h3>
                <button class="modal-close" id="closeJournalModal">&times;</button>
            </div>
            <div class="modal-body">
                <textarea id="journalEntryContent" placeholder="Write your notes here..." rows="8"></textarea>
                <div class="journal-tags-section">
                    <label>Tags (comma-separated):</label>
                    <input type="text" id="journalEntryTags" placeholder="e.g., important, combat, clue">
                    <small class="help-text">Location and NPC tags will be auto-added</small>
                </div>
            </div>
            <div class="modal-footer">
                <button id="deleteJournalEntry" class="btn-danger" style="display: none;">Delete</button>
                <button id="cancelJournalEntry" class="btn-small">Cancel</button>
                <button id="saveJournalEntry" class="btn-primary">Save</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
